<?xml version="1.0" encoding="utf-8" ?>
<!--
  ~ Copyright 2022 Simone Rubino
  ~ License AGPL-3.0 or later (https://www.gnu.org/licenses/agpl).
  -->
<odoo>
    <template
        id="registration_attendee_details"
        inherit_id="website_event.registration_attendee_details"
        name="Add tournament details to attendee registration"
    >
        <xpath
            expr="//t[@name='attendee_loop']//*[hasclass('modal-body')]"
            position="inside"
        >
            <div class="row" style="border: solid 2px red;" t-if="event.tournament_ids">
                <div class="col">
                    <label>Birthday</label>
                    <input
                        class="form-control"
                        type="date"
                        t-attf-name="#{counter}-birthdate_date"
                        required="required"
                    />
                </div>
                <div class="col">
                    <t
                        t-set="gender_description"
                        t-value="env['event.registration']._fields['gender'].get_description(env)"
                    />
                    <t
                        t-set="gender_selection"
                        t-value="gender_description['selection']"
                    />
                    <label>Gender</label>
                    <select
                        class="form-control"
                        t-attf-name="#{counter}-gender"
                        required="required"
                    >
                        <option value="" selected="selected">Select...</option>
                        <t t-foreach="gender_selection" t-as="value_string">
                            <option
                                t-att-value="value_string[0]"
                                t-esc="value_string[1]"
                            />
                        </t>
                    </select>
                </div>
                <div class="col">
                    <label t-attf-for="#{counter}-is_fipav">
                        Is FIPAV
                    </label>
                    <input
                        class="form-control"
                        type="checkbox"
                        t-attf-name="#{counter}-is_fipav"
                        t-attf-id="#{counter}-is_fipav"
                    />
                </div>
            </div>
            <div
                t-foreach="event.tournament_ids"
                t-as="tournament"
                class="row"
                style="border: solid 2px red;"
            >
                <div class="col-2 align-self-center" style="text-align-last: end;">
                    <strong t-esc="tournament.name" />
                </div>
                <div class="col">
                    <label>Team name</label>
                    <input
                        class="form-control"
                        type="text"
                        t-attf-name="team_name-#{counter}-#{tournament.id}"
                        placeholder="Banana hammocks"
                    />
                </div>
                <div class="align-self-center col-2" t-if="ticket['quantity'] > 1">
                    <button
                        type="button"
                        class="btn btn-info"
                        name="js_copy_team"
                        t-attf-data-team-input="team_name-#{counter}-#{tournament.id}"
                    >
                        Copy to other participants
                    </button>
                </div>
                <!-- TODO Add button to copy team names in other attendees -->
            </div>
        </xpath>
    </template>

    <template
        id="registration_complete"
        inherit_id="website_event.registration_complete"
        name="Add tournament details to attendee confirmation"
    >
        <xpath expr="//t[@t-if='attendee.email']/.." position="before">
            <t t-set="tournaments" t-value="attendee.tournament_ids" />
            <ul class="fa-ul" t-if="tournaments">
                <li t-foreach="attendee.tournament_ids" t-as="tournament">
                    <span class="fa-li">
                        <i class="fa fa-trophy" />
                    </span>
                    <span t-esc="tournament.name" />

                    <t
                        t-set="tournament_teams"
                        t-value="attendee.tournament_team_ids.filtered(lambda t: t.tournament_id == tournament)"
                    />
                    <ul class="fa-ul">
                        <li t-foreach="tournament_teams" t-as="team">
                            <span class="fa-li">
                                <i class="fa fa-users" />
                            </span>
                            <span t-esc="team.name" />
                        </li>
                    </ul>
                </li>
            </ul>
        </xpath>
    </template>
</odoo>
